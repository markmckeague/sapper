{"version":3,"file":"cli.ts.js","sources":["../src/cli.ts"],"sourcesContent":["import * as fs from 'fs';\nimport * as path from 'path';\nimport * as child_process from 'child_process';\nimport sade from 'sade';\nimport * as colors from 'ansi-colors';\nimport prettyMs from 'pretty-ms';\n// import upgrade from './cli/upgrade';\nimport * as ports from 'port-authority';\nimport * as pkg from '../package.json';\n\nconst prog = sade('sapper').version(pkg.version);\n\nprog.command('dev')\n\t.describe('Start a development server')\n\t.option('-p, --port', 'Specify a port')\n\t.option('-o, --open', 'Open a browser window')\n\t.action(async (opts: { port: number, open: boolean }) => {\n\t\tconst { dev } = await import('./cli/dev');\n\t\tdev(opts);\n\t});\n\nprog.command('build [dest]')\n\t.describe('Create a production-ready version of your app')\n\t.option('-p, --port', 'Default of process.env.PORT', '3000')\n\t.example(`build custom-dir -p 4567`)\n\t.action(async (dest = 'build', opts: { port: string }) => {\n\t\tconsole.log(`> Building...`);\n\n\t\tprocess.env.NODE_ENV = process.env.NODE_ENV || 'production';\n\t\tprocess.env.SAPPER_DEST = dest;\n\n\t\tconst start = Date.now();\n\n\t\ttry {\n\t\t\tconst { build } = await import('./cli/build');\n\t\t\tawait build();\n\n\t\t\tconst launcher = path.resolve(dest, 'index.js');\n\n\t\t\tfs.writeFileSync(launcher, `\n\t\t\t\t// generated by sapper build at ${new Date().toISOString()}\n\t\t\t\tprocess.env.NODE_ENV = process.env.NODE_ENV || 'production';\n\t\t\t\tprocess.env.SAPPER_DEST = __dirname;\n\t\t\t\tprocess.env.PORT = process.env.PORT || ${opts.port || 3000};\n\n\t\t\t\tconsole.log('Starting server on port ' + process.env.PORT);\n\t\t\t\trequire('./server.js');\n\t\t\t`.replace(/^\\t+/gm, '').trim());\n\n\t\t\tconsole.error(`\\n> Finished in ${elapsed(start)}. Type ${colors.bold.cyan(`node ${dest}`)} to run the app.`);\n\t\t} catch (err) {\n\t\t\tconsole.error(err ? err.details || err.stack || err.message || err : 'Unknown error');\n\t\t\tprocess.exit(1);\n\t\t}\n\t});\n\nprog.command('start [dir]')\n\t.describe('Start your app')\n\t.option('-p, --port', 'Specify a port')\n\t.option('-o, --open', 'Open a browser window')\n\t.action(async (dir = 'build', opts: { port: number, open: boolean }) => {\n\t\tconst { start } = await import('./cli/start');\n\t\tstart(dir, opts);\n\t});\n\nprog.command('export [dest]')\n\t.describe('Export your app as static files (if possible)')\n\t.option('--basepath', 'Specify a base path')\n\t.action(async (dest = 'export', opts: { basepath?: string }) => {\n\t\tconsole.log(`> Building...`);\n\n\t\tprocess.env.NODE_ENV = 'production';\n\t\tprocess.env.SAPPER_DEST = '.sapper/.export';\n\n\t\tconst start = Date.now();\n\n\t\ttry {\n\t\t\tconst { build } = await import('./cli/build');\n\t\t\tawait build();\n\t\t\tconsole.error(`\\n> Built in ${elapsed(start)}. Crawling site...`);\n\n\t\t\tconst { exporter } = await import('./cli/export');\n\t\t\tawait exporter(dest, opts);\n\t\t\tconsole.error(`\\n> Finished in ${elapsed(start)}. Type ${colors.bold.cyan(`npx serve ${dest}`)} to run the app.`);\n\t\t} catch (err) {\n\t\t\tconsole.error(err ? err.details || err.stack || err.message || err : 'Unknown error');\n\t\t\tprocess.exit(1);\n\t\t}\n\t});\n\n// TODO upgrade\n\nprog.parse(process.argv);\n\nfunction elapsed(start: number) {\n\treturn prettyMs(Date.now() - start);\n}\n"],"names":["pkg.version","path.resolve","fs.writeFileSync","colors.bold"],"mappings":"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"}