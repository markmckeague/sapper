{"version":3,"file":"dev.ts.js","sources":["../src/cli/dev.ts"],"sourcesContent":["import * as path from 'path';\nimport * as colors from 'ansi-colors';\nimport * as child_process from 'child_process';\nimport prettyMs from 'pretty-ms';\nimport { dev as _dev } from '../api/dev';\nimport * as events from '../api/interfaces';\n\nexport function dev(opts: { port: number, open: boolean }) {\n\ttry {\n\t\tconst watcher = _dev(opts);\n\n\t\tlet first = true;\n\n\t\twatcher.on('ready', (event: events.ReadyEvent) => {\n\t\t\tif (first) {\n\t\t\t\tconsole.log(`${colors.bold.cyan(`> Listening on http://localhost:${event.port}`)}`);\n\t\t\t\tif (opts.open) child_process.exec(`open http://localhost:${event.port}`);\n\t\t\t\tfirst = false;\n\t\t\t}\n\n\t\t\t// TODO clear screen?\n\n\t\t\tevent.process.stdout.on('data', data => {\n\t\t\t\tprocess.stdout.write(data);\n\t\t\t});\n\n\t\t\tevent.process.stderr.on('data', data => {\n\t\t\t\tprocess.stderr.write(data);\n\t\t\t});\n\t\t});\n\n\t\twatcher.on('invalid', (event: events.InvalidEvent) => {\n\t\t\tconst changed = event.changed.map(filename => path.relative(process.cwd(), filename)).join(', ');\n\t\t\tconsole.log(`\\n${colors.bold.cyan(changed)} changed. rebuilding...`);\n\t\t});\n\n\t\twatcher.on('error', (event: events.ErrorEvent) => {\n\t\t\tconsole.log(`${colors.red(`✗ ${event.type}`)}`);\n\t\t\tconsole.log(`${colors.red(event.message)}`);\n\t\t});\n\n\t\twatcher.on('fatal', (event: events.FatalEvent) => {\n\t\t\tconsole.log(`${colors.bold.red(`> ${event.message}`)}`);\n\t\t\tif (event.log) console.log(event.log);\n\t\t});\n\n\t\twatcher.on('build', (event: events.BuildEvent) => {\n\t\t\tif (event.errors.length) {\n\t\t\t\tconsole.log(`${colors.bold.red(`✗ ${event.type}`)}`);\n\n\t\t\t\tevent.errors.filter(e => !e.duplicate).forEach(error => {\n\t\t\t\t\tconsole.log(error.message);\n\t\t\t\t});\n\n\t\t\t\tconst hidden = event.errors.filter(e => e.duplicate).length;\n\t\t\t\tif (hidden > 0) {\n\t\t\t\t\tconsole.log(`${hidden} duplicate ${hidden === 1 ? 'error' : 'errors'} hidden\\n`);\n\t\t\t\t}\n\t\t\t} else if (event.warnings.length) {\n\t\t\t\tconsole.log(`${colors.bold.yellow(`• ${event.type}`)}`);\n\n\t\t\t\tevent.warnings.filter(e => !e.duplicate).forEach(warning => {\n\t\t\t\t\tconsole.log(warning.message);\n\t\t\t\t});\n\n\t\t\t\tconst hidden = event.warnings.filter(e => e.duplicate).length;\n\t\t\t\tif (hidden > 0) {\n\t\t\t\t\tconsole.log(`${hidden} duplicate ${hidden === 1 ? 'warning' : 'warnings'} hidden\\n`);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.log(`${colors.bold.green(`✔ ${event.type}`)} ${colors.gray(`(${prettyMs(event.duration)})`)}`);\n\t\t\t}\n\t\t});\n\t} catch (err) {\n\t\tconsole.log(`${colors.bold.red(`> ${err.message}`)}`);\n\t\tprocess.exit(1);\n\t}\n}"],"names":["_dev","colors.bold","child_process.exec","path.relative","colors.red","colors.gray"],"mappings":"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"}